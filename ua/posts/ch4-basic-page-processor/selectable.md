## 4.2 Послідовність `API Selectable` селекторності


Вибір релевантної послідовності `API Selectable` для селекторів це базова функція WebMagic. Для використання інтерфейсу селекторності (селективного вибору для екстракції) можна використати пряму послідовність доступу до елементів сторінки та потрібно подбати про уточнюючи деталі.

Можна побачити у попередньому прикладі `page.getHtml()` повертає об'єкт `Html`, який імплементує інтерфейс `Selectable`. Цей інтерфейс містить декілька важливих шляхів. Я розділив його на дві категорії: розтин на частини для екстракції і повернення отриманих результатів.


#### Селектори для екстракції v.4.2.1 API:

| метод | опис | приклади |
| ------------ | ------------- | ------------ |
| xpath(String xpath) | використання XPath селектора  | html.xpath("//div[@class='title']") |
| $(String selector) | використання CSS селектора для вибору  | html.$("div.title") |
| $(String selector,String attr) | використання CSS селектора для вибору | html.$("div.title","text") |
| css(String selector) | функція з $(), використання CSS селектора для вибору | html.css("div.title") |
| links() | вибрати усі лінки | html.links() |
| regex(String regex) | використання регулярний вираз для екстракції  | html.regex("\<div\>(.\*?)\</div>") |
| regex(String regex,int group) | використання регулярний вираз для екстракції та вказати порядковий номер групи для обробки | html.regex("\<div\>(.\*?)\</div>",1) |
| replace(String regex, String replacement) | замінити вміст | html.replace("\<script>.\*\</script>","")|

Ця частина зробила екстракцюї  та повертає результат через інтерфейс API  `Selectable`, а це означає, що підтримується послідовність викликів для екстракції. Наведу приклад використання послідовності  API.

Припустимо зараз я хочу захопити та зібрати (екстрактувати) всі проекти Java на GitHub, ці елементи можна побачити  [https://github.com/search?l=Java&p=1&q=stars%3A%3E1&s=stars&type=Repositories](https://github.com/search?l=Java&p=1&q=stars%3A%3E1&s=stars&type=Repositories) - наведені результати пошуку.

Щоб уникнути занадто широкого сканування, я вказав обмеження - сканувати лише посилання з секції закладок сторінок (пейджинатора). Правила обходу контенту булиб більш складними, я би було б їх записувати?

![selectable-chain-ui](http://webmagic.qiniudn.com/oscimages/151454_2T01_190591.png)

По-перше, розглянемо структуру HTML сторінки, що типово виглядає наступним чином:

![selectable-chain](http://webmagic.qiniudn.com/oscimages/151632_88Oq_190591.png)

Тоді видно, що мона використовувати CSS селектори, щоб екстрактувати (витягти) цей `<DIV>`, а потім взяти всі посилання. Для перестрахування, я буду використовувати регулярні вирази, щоб визначити, що формат витягнутого - URL, у підсумку остаточне формулювання виглядає так:

```java
List<String> urls = page.getHtml().css("div.pagination").links().regex(".*/search/\?l=java.*").all();
```

Тоді ми можемо додати ці URL-и до списку для сканування:

```java
List<String> urls = page.getHtml().css("div.pagination").links().regex(".*/search/\?l=java.*").all();
page.addTargetRequests(urls);
```

Це не просто? Додатково для пошуку посилань-лінків, послідовності селекторної `Selectable` екстракції  також може зробити багато роботи. У розділі 9 ми знову будемо розбирати наведені вище приклади.

#### 4.2.2 Get Results API для отримання результатів:

Коли викликаємо послідовності, ми звичайно хочемо отримати у результаті тип `String`. Цого разу ми повинні використовувати Get Results API для отримання результатів. Ми знаємо, що з правилами екстакції `XPath` чи `CSS` селектори або регулярний вираз regular expression, завжди можна витягти безліч елементів. У WebMagic вони були уніфіковані, тому ви можете отримати один або кілька елементів за допомогою різних API.

| метод | опис | приклади |
| ------------ | ------------- | ------------ |
| get() | повертає результат типу String | String link= html.links().get()|
| toString() | функція get(), повертає результат типу String | String link= html.links().toString()|
| all() | повертає всі результати вилучення | List<String> links= html.links().all()|
| match() | якщо результат співпадає | if (html.links().match()){ xxx; }|

Наприклад, у випадках коли ми знаємо, що сторінка буде мати результат, тоді можна використовувати `selectable.get()` або `selectable.toString()`, щоб отримати цей результат.

У цьому випадку `selectable.toString()` використовує `toString()` цього інтерфейсу, це добре для виведення та фреймворків при комбінації, більш зручними. Тому що при нормальних обставинах, нам потрібно тільки вибрати один елемент!

`selectable.all()` - у результаті отримаєте всі елементів.

Ну а тепер, якщо озирнутися назад на Частину 3.1 GithubRepoPageProcessor, можливо ви вже відчувати себе більш ясно, чи не так? Специфікувати `main()` метод, і тоді  вже можна побачити результати роботи пошукача консолі виводу CLI.
