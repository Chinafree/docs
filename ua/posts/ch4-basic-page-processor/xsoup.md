### 4.5  Знайомство з інструментами вилучення - екстракцією

Екстрактор пошукача WebMagic extraction базується на використанні [Jsoup](http://jsoup.org/) і моїй власній розробці [Xsoup](https://github.com/code4craft/xsoup).

#### 4.5.1 `Jsoup`

`Jsoup` це простий HTML-парсер, що підтримує використання `CSS` селекторів, як спосіб знайти елементи. Для цілей розробки WebMagic, проведено детальний аналіз з сирцевим кодом `Jsoup` конкретних статей див. [Jsoup - нотатки дослідженнь](https://github.com/code4craft/jsoup-learning).

#### 4.5.2 `Xsoup`
[Xsoup](https://github.com/code4craft/xsoup) заснований на `Jsoup`, розроблявся як `XPath` аналізатор.
Раніше для парсера WebMagic застосовувався [HtmlCleaner](http://htmlcleaner.sourceforge.net/), у якого є деякі проблеми під час використання. Основна його проблема полягає в точностях та помилках `XPath` - локалізації у сторінках якого не валідна структура коду, і це складно налаштувати.

Реалізований `Xsoup` більш відповідає до потреб пошукових сканерів. Також приємно відзначити - тестування показує продуктивність `Xsoup` перевищує `HtmlCleaner` більше, аніж у два рази.
Розробка `Xsoup` продовжується і досі, зараз підтримується загальний синтаксис для парсингу, що приведено у таблиці:

<table>
    <tr>
        <td>Назва</td>
        <td>Вираз</td>
        <td>Підтримка</td>
    </tr>
    <tr>
        <td>nodename</td>
        <td>nodename</td>
        <td>так</td>
    </tr>
    <tr>
        <td>immediate parent</td>
        <td>/</td>
        <td>так</td>
    </tr>
    <tr>
        <td>parent</td>
        <td>//</td>
        <td>так</td>
    </tr>
    <tr>
        <td>attribute</td>
        <td>[@key=value]</td>
        <td>так</td>
    </tr>
    <tr>
        <td>nth child</td>
        <td>tag[n]</td>
        <td>так</td>
    </tr>
    <tr>
        <td>attribute</td>
        <td>/@key</td>
        <td>так</td>
    </tr>
    <tr>
        <td>wildcard in tagname</td>
        <td>/*</td>
        <td>так</td>
    </tr>
    <tr>
        <td>wildcard in attribute</td>
        <td>/[@*]</td>
        <td>так</td>
    </tr>
    <tr>
        <td>function</td>
        <td>function()</td>
        <td>частково</td>
    </tr>
    <tr>
        <td>or</td>
        <td>a | b</td>
        <td>так, починаючи з 0.2.0</td>
    </tr>
    <tr>
        <td>parent in path</td>
        <td>. or ..</td>
        <td>ні</td>
    </tr>
    <tr>
        <td>predicates</td>
        <td>price>35</td>
        <td>ні</td>
    </tr>
    <tr>
        <td>predicates logic</td>
        <td>@class=a or @class=b</td>
        <td>так, починаючи з 0.2.0</td>
    </tr>
</table>

Зазначте, що це умовні визначення - часні - лише для пошукоча і за для зручності використання функції `XPath`, проте ці функції не є стандартами `XPath` - зверніть на це увагу.

| Вираз | Опис | XPath1.0 |
| -------- | ------- | ------- |
|text(n) | текст безпосередньо n-го дочірнього вузола, якщо 0 - тоді для всіх | тільки text()|
|allText() | всі прямі і непрямі тексти дочірніх вузлів | не підтримує |
|tidyText() | всі прямі і непрямі тексти дочірніх вузлів, а також замінити деякі мітки обгорок, так, щоб відображався очищенний звичайний текст | не підтримує |
| html() | внутрішній HTML, HTML теги не вміщати в себе | не підтримує |
| outerHtml() | внутрішній HTML, вміщувати в тому числі тегі HTML у себе | не підтримує |
| regex(@attr,expr,group)  | тут @attr і може бути вибраний з групи, за замовчуванням group0 | не підтримує |

#### 4.5.3 Saxon

[Saxon](http://saxon.sourceforge.net/) є потужним аналізатор `XPath` з підтримкою [XPath 2.0](https://www.wikiwand.com/en/XPath_2.0) синтаксису. `Webmagic-saxon` інтеграція з `Saxon` є попередніми. Але тепер, схоже, синтакис `XPath 2.0` є передовим, і здається, що його використовують у розробці не так багато пошукових сканерів.
